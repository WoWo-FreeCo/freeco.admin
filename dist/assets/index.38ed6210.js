import{y as Ve,k as i,ay as ge,C as W,o as V,b as U,w as r,p as a,q as o,ba as x,D as J,b7 as Q,c as T,F as X,a as Y,m as R,V as g,$ as z,a0 as $,z as Z,bo as be,bp as we,j as ye}from"./index.81a573ca.js";import{_ as _e}from"./ConfirmDialog.bdeaf741.js";import{_ as ke}from"./RichTextEditor.2ccb2d51.js";import{P as q,a as A,c as Pe,m as Ie,n as Ce}from"./requestURL.2ee67e65.js";import{u as De}from"./prodStore.85e8fd14.js";import{V as v}from"./VCol.398b018c.js";import{V as w}from"./VTextField.f6361a39.js";import{V as M}from"./VSelect.ba2bc871.js";import{V as ee}from"./VFileInput.8b81b37a.js";import{V as y}from"./VBtn.b672f002.js";import{V as Ue}from"./VRow.67af9cc4.js";import{V as xe}from"./VForm.5bd79259.js";import"./VDialog.6e2ad510.js";import"./scopeId.2f150327.js";import"./forwardRefs.54bb1675.js";import"./axios.364130a5.js";import"./index.d28f26f2.js";import"./VList.e682e2be.js";import"./VDivider.250021f4.js";import"./VMenu.366f1be2.js";import"./VChip.9fb5519d.js";const Re={key:0,class:"images-flex"},ze={class:"plus-image d-flex"},$e={class:"d-flex",cols:"0"},Ne={__name:"index",setup(he){const _="https://api.wowo.tw",le=i(),O=De(),ae=["\u4E00\u822C","\u51B7\u93C8"],te={skuId:"",categoryName:"",name:"",price:0,memberPrice:0,vipPrice:0,svipPrice:0,attribute:"\u4E00\u822C"},k=i(),P=i(),S=i(!0),N=i(!1),b=i(""),u=i({}),n=i(te),E=i({}),L=i([]),B=i(),h=i(),m=i(""),I=i(""),c=i(),C=i(!1),j=we(),G=ye();ge(async()=>{await H()});async function H(){var t,e,d,s;try{const l=await O.fetchProductCategory(),p=await O.fetchProducts(),f=await O.fetchProductDetail((t=j.query)==null?void 0:t.id),D=[];(d=(e=l.data)==null?void 0:e.data)==null||d.forEach(F=>{D.push(F.name)}),L.value=D,E.value=l.data.data,B.value=p.data.data,c.value=(s=f.data.data)==null?void 0:s.markdownInfos,c.value.length?m.value=c.value[0].title:m.value="\u76EE\u524D\u6A19\u865F\u9801\u8CC7\u6599\u70BA\u7A7A",ne()}catch(l){console.log(l)}}W(k,async t=>{S.value=!k.value[0];try{const e=new FormData;e.append("image",k.value[0]);const s=await(await fetch(`${_}/${q}`,{method:"POST",body:e})).json();console.log("\u5716\u7247 response: ",s),b.value=`${_}/${s.filenames[0]}`}catch(e){console.log(e)}}),W(P,async t=>{S.value=!0;try{const e=new FormData;P.value.forEach(l=>{e.append("image",l)}),console.log(P.value);const s=await(await fetch(`${_}/${q}`,{method:"POST",body:e})).json();console.log("\u5716\u7247 response: ",s),u.value=s.filenames.map(l=>({url:`${_}/${l}`})),console.log(u.value)}catch(e){console.log(e)}S.value=!1});async function oe(){try{if(!n.value.attribute)return alert("\u8ACB\u9078\u64C7\u5546\u54C1\u904B\u9001\u985E\u578B");if(!n.value.skuId)return alert("\u8ACB\u8F38\u5165\u5546\u54C1\u6A19\u865F");if(!n.value.categoryName)return alert("\u8ACB\u9078\u64C7\u5546\u54C1\u5206\u985E");const t={...n.value,attribute:n.value.attribute==="\u51B7\u93C8"?"COLD_CHAIN":"GENERAL",categoryId:E.value.find(e=>e.name===n.value.categoryName).id,coverImagePath:b.value};delete t.categoryName,b.value||delete t.coverImagePath,await A.put(`/${Pe(h.value.id)}`,t),console.log(c.value),await A.put(`/${Ie(h.value.id)}`,{markdownInfos:[...c.value]}),await A.put(`/${Ce(h.value.id)}`,{images:[...u.value.map(e=>({img:(e==null?void 0:e.url)||""}))]}),alert("\u5DF2\u66F4\u65B0\u5546\u54C1\u8CC7\u8A0A")}catch(t){console.log(t)}}function ne(){var d,s,l,p;const t=(d=j.query)==null?void 0:d.id;if(!t)return G.push({path:"/apps/product/list"});const e=(s=B.value)==null?void 0:s.find(f=>f.id==t);if(!e)return G.push({path:"/apps/product/list"});h.value=e,b.value=e==null?void 0:e.coverImg,u.value=(l=e==null?void 0:e.images)==null?void 0:l.map(f=>({url:f.img,id:f.index})),console.log(e),n.value={...n.value,skuId:e.skuId,name:e.name,price:e.price,memberPrice:e.memberPrice,vipPrice:e.vipPrice,svipPrice:e.svipPrice,categoryName:(p=E.value.find(f=>f.id===e.categoryId))==null?void 0:p.name,attribute:e.attribute==="COLD_CHAIN"?"\u51B7\u93C8":"\u4E00\u822C"}}function re(){b.value="",console.log(122,b.value)}function ue(){u.value=[]}function se(){H()}function ie(t){!t||(c.value=c.value.filter(e=>e.title!==m.value),m.value=c.value.length?c.value[0].title:"\u76EE\u524D\u6A19\u865F\u9801\u70BA\u7A7A")}function ce(){const t="\u5546\u54C1\u8CC7\u8A0A\u9801\u7C64";m.value=t,c.value.push({title:t,text:"\u8ACB\u586B\u5165\u5546\u54C1\u8CC7\u8A0A"})}function de(){C.value=!0,I.value=m.value}function me(){c.value.find(t=>t.title===m.value).title=I.value,C.value=!1,m.value=I.value}function pe(){console.log(222),C.value=!1}function fe(t){u.value=u.value.filter(e=>e.id!==t.id)}function ve(t){const e=new FileReader,[d]=t.target.files||void 0;t.target.value=null,e.readAsDataURL(d),e.onload=async()=>{const s=new FormData,{size:l}=d;if(l/1024/1024>1)return alert("\u5716\u7247\u6A94\u6848\u904E\u5927\uFF0C\u8ACB\u91CD\u65B0\u4E0A\u50B3 < 1mb");s.append("image",d);const D=await(await fetch(`${_}/${q}`,{method:"POST",body:s})).json();if(!D.filenames.length)return;console.log(D);const F=`${_}/${D.filenames[0]}`;u.value.push({id:Math.random()*99999,url:F})}}function K(t,e=""){!e||(e==="next"?[u.value[t],u.value[t+1]]=[u.value[t+1],u.value[t]]:e==="prev"&&([u.value[t],u.value[t-1]]=[u.value[t-1],u.value[t]]),console.log(u.value,t))}return(t,e)=>{const d=ke,s=_e;return V(),U(xe,{ref_key:"form",ref:le,"lazy-validation":"",onSubmit:e[14]||(e[14]=be(()=>{},["prevent"]))},{default:r(()=>[a(Ue,null,{default:r(()=>[a(v,{cols:"12"},{default:r(()=>[a(w,{modelValue:o(n).name,"onUpdate:modelValue":e[0]||(e[0]=l=>o(n).name=l),label:"\u5546\u54C1\u540D\u7A31",required:""},null,8,["modelValue"])]),_:1}),a(v,{cols:"12"},{default:r(()=>[a(w,{modelValue:o(n).skuId,"onUpdate:modelValue":e[1]||(e[1]=l=>o(n).skuId=l),label:"\u5546\u54C1\u6A19\u865F",required:""},null,8,["modelValue"])]),_:1}),a(v,{cols:"12"},{default:r(()=>[a(w,{modelValue:o(n).price,"onUpdate:modelValue":e[2]||(e[2]=l=>o(n).price=l),label:"\u5B9A\u50F9",required:"",min:"0",type:"number"},null,8,["modelValue"])]),_:1}),a(v,{cols:"12"},{default:r(()=>[a(w,{modelValue:o(n).memberPrice,"onUpdate:modelValue":e[3]||(e[3]=l=>o(n).memberPrice=l),label:"\u6703\u54E1\u50F9",required:"",type:"number",min:"0"},null,8,["modelValue"])]),_:1}),a(v,{cols:"12"},{default:r(()=>[a(w,{modelValue:o(n).vipPrice,"onUpdate:modelValue":e[4]||(e[4]=l=>o(n).vipPrice=l),label:"VIP\u50F9",required:"",type:"number",min:"0"},null,8,["modelValue"])]),_:1}),a(v,{cols:"12"},{default:r(()=>[a(w,{modelValue:o(n).svipPrice,"onUpdate:modelValue":e[5]||(e[5]=l=>o(n).svipPrice=l),label:"SVIP\u50F9",required:"",type:"number",min:"0"},null,8,["modelValue"])]),_:1}),a(v,{cols:"12"},{default:r(()=>[a(M,{modelValue:o(n).categoryName,"onUpdate:modelValue":e[6]||(e[6]=l=>o(n).categoryName=l),items:o(L),label:"\u5546\u54C1\u5206\u985E",name:"select-1",require:""},null,8,["modelValue","items"])]),_:1}),a(v,{cols:"12"},{default:r(()=>[a(M,{modelValue:o(n).attribute,"onUpdate:modelValue":e[7]||(e[7]=l=>o(n).attribute=l),items:ae,label:"\u5546\u54C1\u904B\u9001\u985E\u578B",name:"select-2",require:""},null,8,["modelValue"])]),_:1}),a(v,{cols:"12",class:"gap-4"},{default:r(()=>[a(ee,{modelValue:o(k),"onUpdate:modelValue":e[8]||(e[8]=l=>x(k)?k.value=l:null),accept:"image/*","show-size":"",counter:"",color:"success",label:"\u4E0A\u50B3\u5546\u54C1\u7E2E\u5716","onClick:clear":re},null,8,["modelValue"]),o(b)?(V(),U(J,{key:0,width:"200",src:o(b)},null,8,["src"])):Q("",!0)]),_:1}),a(v,{cols:"12",class:"gap-4"},{default:r(()=>[a(ee,{modelValue:o(P),"onUpdate:modelValue":e[9]||(e[9]=l=>x(P)?P.value=l:null),accept:"image/*",multiple:"","show-size":"",counter:"",color:"primary",label:"\u4E0A\u50B3\u5546\u54C1\u8F2A\u64AD\u5716","onClick:clear":ue},null,8,["modelValue"]),o(u)?(V(),T("div",Re,[(V(!0),T(X,null,Y(o(u),(l,p)=>(V(),T("div",{key:(l==null?void 0:l.id)||(l==null?void 0:l.url)||(l==null?void 0:l.img),class:"image-element"},[a(J,{width:"200",src:l.url},null,8,["src"]),a(g,{class:"icon",size:22,color:"error",icon:"tabler-circle-x",onClick:f=>fe(l)},null,8,["onClick"]),z(a(g,{class:"icon to-prev",size:22,color:"info",icon:"tabler-arrow-narrow-left",onClick:f=>K(p,"prev")},null,8,["onClick"]),[[$,p!==0]]),z(a(g,{class:"icon to-next",size:22,color:"info",icon:"tabler-arrow-narrow-right",onClick:f=>K(p,"next")},null,8,["onClick"]),[[$,p!==o(u).length-1]])]))),128)),R("div",ze,[a(g,{size:100,color:"success",icon:"tabler-circle-plus"}),R("input",{id:"plus-new-image",class:"upload-image",type:"file",accept:"image/*",name:"upload-image",onChange:ve},null,32)])])):Q("",!0)]),_:1}),a(v,{cols:"12"},{default:r(()=>[R("div",$e,[o(C)?(V(),U(w,{key:1,modelValue:o(I),"onUpdate:modelValue":e[11]||(e[11]=l=>x(I)?I.value=l:null),label:"\u8ACB\u8F38\u5165\u65B0\u7684\u9801\u7C64\u540D\u7A31"},null,8,["modelValue"])):(V(),U(M,{key:0,modelValue:o(m),"onUpdate:modelValue":e[10]||(e[10]=l=>x(m)?m.value=l:null),items:o(c),label:"\u7576\u524D\u9801\u7C64",class:"prod-tabs"},null,8,["modelValue","items"])),z(R("div",null,[a(y,{icon:"",variant:"text",color:"default",size:"x-small",onClick:de},{default:r(()=>[a(g,{size:22,icon:"tabler-edit-circle"})]),_:1}),a(y,{icon:"",variant:"text",color:"default",size:"x-small",onClick:e[12]||(e[12]=l=>N.value=!0)},{default:r(()=>[a(g,{size:22,icon:"tabler-circle-minus"})]),_:1}),a(y,{icon:"",variant:"text",color:"default",size:"x-small",onClick:ce},{default:r(()=>[a(g,{size:22,icon:"tabler-circle-plus"})]),_:1})],512),[[$,!o(C)]]),z(R("div",null,[a(y,{icon:"",variant:"text",color:"success",size:"x-small",onClick:me},{default:r(()=>[a(g,{size:22,icon:"tabler-circle-check"})]),_:1}),a(y,{icon:"",variant:"text",color:"error",size:"x-small",onClick:pe},{default:r(()=>[a(g,{size:22,icon:"tabler-circle-x"})]),_:1})],512),[[$,o(C)]])]),(V(!0),T(X,null,Y(o(c),l=>z((V(),U(d,{key:l==null?void 0:l.title,modelValue:l.text,"onUpdate:modelValue":p=>l.text=p,class:"editor","max-limit":999999},null,8,["modelValue","onUpdate:modelValue"])),[[$,o(m)===l.title]])),128))]),_:1}),a(v,{cols:"12",class:"d-flex gap-4"},{default:r(()=>[a(y,{type:"submit",onClick:oe},{default:r(()=>[Z(" \u66F4\u65B0 ")]),_:1}),a(y,{color:"secondary",variant:"tonal",onClick:se},{default:r(()=>[Z(" \u5FA9\u539F\u8CC7\u6599 ")]),_:1})]),_:1})]),_:1}),a(s,{isDialogVisible:o(N),"onUpdate:isDialogVisible":e[13]||(e[13]=l=>x(N)?N.value=l:null),"confirmation-msg":"\u78BA\u5B9A\u8981\u522A\u9664\u7576\u524D\u7684\u5546\u54C1\u9801\u7C64\uFF1F\u6587\u5B57\u8CC7\u6599\u5C07\u7121\u6CD5\u5FA9\u539F",onConfirm:ie},null,8,["isDialogVisible"])]),_:1},512)}}},ll=Ve(Ne,[["__scopeId","data-v-bb2d2954"]]);export{ll as default};
