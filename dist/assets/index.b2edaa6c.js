import{y as T,k as s,ay as U,C as F,o as V,b as h,w as n,p as t,q as c,ba as N,D as S,b7 as $,z as y,bo as E,bp as M,j as O}from"./index.814ba5dc.js";import{P as q,a as z,v as A}from"./requestURL.4ab77af1.js";import{u as j}from"./bannerStore.b17b5f32.js";import{V as f}from"./VCol.64655a44.js";import{V as L}from"./VFileInput.4bf4cb4a.js";import{V as G}from"./VTextField.4b3881bb.js";import{V as w}from"./VBtn.15cc7225.js";import{V as H}from"./VRow.116d4872.js";import{V as J}from"./VForm.e0345dcf.js";import"./axios.364130a5.js";import"./forwardRefs.54bb1675.js";import"./VChip.bd7ca155.js";import"./index.c82ae7fd.js";const K={__name:"index",setup(Q){const d="https://api.wowo.tw",b=s(),g=j(),x={img:"",href:""},I=s(!1),r=s(x),m=s([]),_=s(),l=s(),u=s(),k=M(),p=O();U(async()=>{await v()}),F(l,async a=>{I.value=!l.value[0];try{const e=new FormData;e.append("image",l.value[0]);const i=await(await fetch(`${d}/${q}`,{method:"POST",body:e})).json();console.log("\u5716\u7247 response: ",i),u.value=`${d}/${i.filenames[0]}`}catch(e){console.log(e)}});async function v(){try{const a=await g.fetchBanners();m.value=a.data.data,C()}catch(a){console.log(a)}}async function B(){try{if(!r.value.href)return alert("\u8ACB\u8F38\u5165\u6A6B\u5E45\u7684\u5B50\u9801\u9762\u8DEF\u5F91");const a={...r.value,img:u.value};await z.put(`/${A(_.value.id)}`,a),alert("\u5DF2\u66F4\u65B0\u6A6B\u5E45"),p.push({path:"/apps/banner/list"})}catch(a){console.log(a)}}function C(){var o,i;const a=(o=k.query)==null?void 0:o.id;if(!a)return p.push({path:"/apps/banner/list"});const e=(i=m.value)==null?void 0:i.find(P=>P.id==a);if(!e)return p.push({path:"/apps/banner/list"});_.value=e,u.value=e==null?void 0:e.img,r.value={...r.value,href:e==null?void 0:e.href}}function R(){v()}function D(){u.value=""}return(a,e)=>(V(),h(J,{ref_key:"form",ref:b,"lazy-validation":"",onSubmit:e[2]||(e[2]=E(()=>{},["prevent"]))},{default:n(()=>[t(H,null,{default:n(()=>[t(f,{cols:"12"},{default:n(()=>[t(L,{modelValue:c(l),"onUpdate:modelValue":e[0]||(e[0]=o=>N(l)?l.value=o:null),accept:"image/*","show-size":"",counter:"",color:"success",label:"\u4E0A\u50B3\u6A6B\u5E45\u5716\u7247","onClick:clear":D},null,8,["modelValue"]),c(u)?(V(),h(S,{key:0,width:"200",src:c(u)},null,8,["src"])):$("",!0)]),_:1}),t(f,{cols:"12"},{default:n(()=>[t(G,{modelValue:c(r).href,"onUpdate:modelValue":e[1]||(e[1]=o=>c(r).href=o),label:"\u6A6B\u5E45\u5B50\u9801\u9762\u8DEF\u5F91",required:"",placeholder:""},null,8,["modelValue"])]),_:1}),t(f,{cols:"12",class:"d-flex gap-4"},{default:n(()=>[t(w,{type:"submit",onClick:B},{default:n(()=>[y(" \u66F4\u65B0 ")]),_:1}),t(w,{color:"secondary",variant:"tonal",onClick:R},{default:n(()=>[y(" \u5FA9\u539F\u8CC7\u6599 ")]),_:1})]),_:1})]),_:1})]),_:1},512))}},ie=T(K,[["__scopeId","data-v-857f62bf"]]);export{ie as default};
